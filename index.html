<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Generator Kode Unik - WAC NasDem</title>
<style>
:root{
--blue-dark:#001f5b;
--blue-mid:#0a3d91;
--gold:#f5b700;
--white:#fff;
--radius:14px;
}
*{box-sizing:border-box;}
body{
font-family:Poppins,sans-serif;
background:linear-gradient(180deg,var(--blue-dark),var(--blue-mid));
margin:0;padding:0;
display:flex;flex-direction:column;align-items:center;justify-content:center;min-height:100vh;color:#222;
}
.container{
background:var(--white);
padding:2rem;
border-radius:var(--radius);
box-shadow:0 6px 30px rgba(0,0,0,0.25);
width:90%;max-width:420px;
}
h1{text-align:center;color:var(--blue-dark);margin-bottom:0.5rem;}
h2{text-align:center;color:var(--gold);margin-top:0;margin-bottom:1.5rem;}
label{font-weight:600;margin-bottom:0.5rem;display:block;}
input,select{width:100%;padding:0.7rem;margin-bottom:1.2rem;border:1px solid #ccc;border-radius:var(--radius);font-size:1rem;}
button{width:100%;background:var(--blue-dark);color:white;border:none;padding:0.9rem;border-radius:var(--radius);font-weight:600;cursor:pointer;transition:all 0.25s ease;}
button:hover{background:var(--gold);color:var(--blue-dark);}
.result{text-align:center;margin-top:1.5rem;font-weight:600;color:var(--blue-dark);word-break:break-word;background:#f7f9fc;padding:1rem;border-radius:var(--radius);border:1px dashed var(--gold);display:none;}
footer{margin-top:2rem;text-align:center;font-size:0.8rem;color:#f5f5f5;}
</style>
</head>
<body>
<div class="container">
<h1>Generator Kode Unik</h1>
<h2>Relawan WAC - Partai NasDem</h2>
<label for="nama">Nama Kepala</label>
<input type="text" id="nama" placeholder="Contoh: Sari" required>
<label for="kecamatan">Kecamatan</label>
<select id="kecamatan">
<option value="">Memuat data...</option>
</select>
<label for="kelurahan">Kelurahan</label>
<select id="kelurahan">
<option value="">Pilih kecamatan terlebih dahulu</option>
</select>
<button id="generateBtn">Generate Kode</button>
<div class="result" id="result"></div>
</div>
<footer>© 2025 WAC NasDem • Dibuat dengan semangat perubahan</footer>

<script>
const scriptURL="https://script.google.com/macros/s/AKfycbxgEI5cR4za_YNVeoWA_W1Vzx7x-ST4e00QbbHO0dpVpRMBHOmzuXi0TRVYvLzywv6_/exec"; // ganti dengan URL Web App

let wilayahData=[];

async function loadWilayah(){
try{
const res=await fetch(`${scriptURL}?action=getWilayah`);
const data=await res.json();
wilayahData=data.data||[];

const kecSelect=document.getElementById("kecamatan");
kecSelect.innerHTML='<option value="">Pilih Kecamatan</option>';
[...new Set(wilayahData.map(w=>w.kecamatan))].forEach(k=>{
kecSelect.innerHTML+=`<option value="${k}">${k}</option>`;
});
}catch(err){
alert("Gagal memuat data wilayah. Periksa koneksi atau izin Apps Script.");
}
}

document.getElementById("kecamatan").addEventListener("change",(e)=>{
const kelSelect=document.getElementById("kelurahan");
kelSelect.innerHTML='<option value="">Pilih Kelurahan</option>';
const selected=e.target.value;
wilayahData.filter(w=>w.kecamatan===selected).forEach(w=>{
kelSelect.innerHTML+=`<option value="${w.kelurahan}">${w.kelurahan}</option>`;
});
});

document.getElementById("generateBtn").addEventListener("click",async()=>{
const nama=document.getElementById("nama").value.trim();
const kelurahan=document.getElementById("kelurahan").value.trim();
const kecamatan=document.getElementById("kecamatan").value.trim();
const resultDiv=document.getElementById("result");
if(!nama||!kelurahan||!kecamatan){alert("Isi semua kolom!");return;}
resultDiv.style.display="block";
resultDiv.innerText="Menghasilkan kode...";
try{
const res=await fetch(scriptURL,{
method:"POST",
body:JSON.stringify({nama,kelurahan,kecamatan}),
headers:{"Content-Type":"application/json"}
});
const data=await res.json();
if(data.success){
resultDiv.innerHTML=`${data.reused?"Kode lama kamu:":"Kode unik baru kamu:"}<br>
<strong style="font-size:1.3rem;color:var(--gold)">${data.token}</strong>`;
}else{
resultDiv.innerText=data.message||"Gagal generate kode.";
}
}catch(err){
console.error(err);
resultDiv.innerText="Terjadi kesalahan koneksi ke server.";
}
});

loadWilayah();
</script>
</body>
</html>
